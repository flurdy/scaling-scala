<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Scaling Scala by @flurdy</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<style>
			body:after {
				content: url(images/flurdy_warped_dual.png);
				position: fixed;
				top: 1.5em;
				right: 0em;
				transform: scale(.15);
			}
			.facetime {
				width: 160px;
				height: 160px;
				border-radius: 100px;
				-webkit-border-radius: 100px;
				-moz-border-radius: 100px;
				box-shadow: 0 0 8px rgba(0, 0, 0, .8);
				-webkit-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
				moz-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
				clear:both;
			}
			.peppa {
				width: 240px;
				height: 160px;
				border-radius: 100px;
				-webkit-border-radius: 100px;
				-moz-border-radius: 100px;
				box-shadow: 0 0 8px rgba(0, 0, 0, .8);
				-webkit-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
				moz-box-shadow: 0 0 8px rgba(0, 0, 0, .8);
				clear:both;
			}
		</style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">


				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
    				<script type="text/template">
## Scaling Scala

not performance but scaling people

by @flurdy

Note:


					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

## Talk context



- Scaling challenges
- Coding styles &amp; frameworks
- Versions
- Architecture &amp; pipeline
- Tooling &amp; automation
- Best practices &amp; battle scars

Best practices for scaling = best practices for non scaling <!-- .element: class="fragment fade-up" data-fragment-index="2" -->

Note:

Preaching to the converted

Or worse/better already doing better things

Keeping version up to date across the teams and projects is tricky

Not covering:
- project management,
- Recruitment,
- Not mandating tech, just showing examples

					</script>
				</section>

				<section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
    				<script type="text/template">

## Who am I

<span class="fragment fade-in" data-fragment-index="1">
	<img src="images/ivar.jpg" class="fragment facetime" data-fragment-index="1"/>
</span>
<span class="fragment fade-in" data-fragment-index="1">
	<img src="images/family.jpg" class="fragment peppa" data-fragment-index="1"/>
</span>


<ul>
	<li class="fragment fade-up" data-fragment-index="1">Ivar Abrahamsen</li>
	<li class="fragment fade-up" data-fragment-index="1">Norwegian. Live in England</li>
	<li class="fragment fade-up" data-fragment-index="2">Consultant at [Eray by Flurdy](https://eray.uk)</li>
	<li class="fragment fade-up" data-fragment-index="2">Writes at <a href="https://flurdy.com/docs">flurdy.com</a></li>
	<li class="fragment fade-up" data-fragment-index="2">Rants at <a href="http://twitter.com/flurdy">@flurdy</a></li>
</ul>


Note:

- Technical Architect, Tech Lead, Dev
- Hampshire with my little girls
- write whilst learning

					</script>
					</section>

					<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    				<script type="text/template">

### Scaling Scala references

- Startup from 50 to 200 employees  <!-- .element: class="fragment" -->
- Public sector grew from 5 to 50+ scala only teams <!-- .element: class="fragment" -->
- Enterprise scaling (non scala) <!-- .element: class="fragment" -->

Note:

- startup quadrupled in 1 year
- about 20 scala developers

- public sector over 200 scala developers

- ie outsourcing
- consultancy, telco &amp; finance) mostly by outsourcing internally


					</script>
				</section>

				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">
### Challenges


* Scala becoming mainstream
* Massive funding expectations
* Chaotic architecture
* Onboarding
* Staff turnover
* Tech pivoting
* Tech debt bankruptcy
* Old school, new school, hipster school

Note:

dont forget scaling references slide

funding via VC or government budget, mandated to be used immediately


TODO!


					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### Assumption


 Agile/Lean/etc, Continuous Integration, devops, pairing, TDD, integration&nbsp;testing,
 DVCS&nbsp;&amp;&nbsp;tools, clouds/IAAS, distributed&nbsp;logging, etc

Common sense <!-- .element: class="fragment" -->

Note:

- splunk, elestricsearch, logstash kibana
- AWS/GCE
- Git, github , gitlab,  bitbucket
- some that I will cover should probably be mentioned here instead

					</script>
				</section>


				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### Best practices

* Internal blog of upcoming changes
* Documented approach to integration, changes | PRs, new mandatory integrations
* Q&amp;A chat rooms for each team/service
* Work/impact across teams &amp; services => pair across
* Upgrade or kill services
* Don't be clever
* Don't be stupid
* Book clubs, snippet chats, hack days
* Encourage tooling
* Auto CI test all PRs and branches

					</script>
				</section>


				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### Coding style

* Company culture / recruitment
* Scala knowledge
* Code for the next one
* ROC: Readability, Optimisation, Correct

Note:

- easy to read
- easy to maintain
- clever, challenging code,
- KISS, continual new java converts.
- Startup , Enterprise, Public sector,
- who will extend/fix it later
- tomorrow/next quarter

- a lot of tech session  sharing knowledge to become more and more FP


					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in fade-out">
	    			<script type="text/template">

### Frameworks


- Standards / Convention <!-- .element: class="fragment" -->
- Best framework for the job per project (startup) <!-- .element: class="fragment" -->
- Same framework as others (public sector) <!-- .element: class="fragment" -->
  <br/>New frameworks via pilot projects <!-- .element: class="fragment" -->


Note:

- per team
- self starter, high skill
- Anything goes Play, Akka, Spray, Unfiltered, Fineagle, Spark
- standardised per team
- Spray and akka services,
- play tools
- node.js customer facing
- Mostly Play
- Dont stagnate

					</script>
				</section>

				<section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

## Versions

JDK, Scala version, library, plugins, API<!-- .element: class="fragment" -->
- Keeping up to date-ish across all projects <!-- .element: class="fragment" -->

Continuous smooth evolution <!-- .element: class="fragment" -->
- Don't stagnate any projects <!-- .element: class="fragment" -->
- No API set in stone forever <!-- .element: class="fragment" -->
- Roll forward <!-- .element: class="fragment" -->

Version practices &amp; tools <!-- .element: class="fragment" -->
- Monorepo <!-- .element: class="fragment" -->
- SBT-Bobby <!-- .element: class="fragment" -->

Note:

- common problem when collaborating across teams and projects
- Common micro service framework dependencies
- Puppet, Docker
- takes a lot of time and energy when scaling
- roll forward api support
- Not force upgrades on every change
- Google announce braking API as comments in API responses
- kill non upgradable services
- how to inform people of version changes

					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### Monorepo

- One source repository to rule them all <!-- .element: class="fragment" data-fragment-index="1" -->
- Instant version changes. <!-- .element: class="fragment" data-fragment-index="1" -->
- Atomic commits across projects <!-- .element: class="fragment" data-fragment-index="1" -->
- Developer fog <!-- .element: class="fragment" data-fragment-index="2" -->
- Complicated parallel delta builds  <!-- .element: class="fragment" data-fragment-index="2" -->

Note:

- Atomic commits across multiple services
- Twitter, Google.
- Pants, blaze
- 1000 of commits per day
- smaller monorepo,
- cvs/subversion days

					</script>
				</section>

				</section>

				<section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### sbt-bobby

- Keeps versions up to date across projects <!-- .element: class="fragment" -->
- SBT plugin<!-- .element: class="fragment" -->: [github.com/hmrc/sbt-bobby](https://github.com/hmrc/sbt-bobby) <!-- .element: class="fragment"  -->
- Set dependencies' versions as outdated <!-- .element: class="fragment" adata-fragment-index="1" -->
- Fail builds  <!-- .element: class="fragment" adata-fragment-index="1" -->
- Grace period to upgrade <!-- .element: class="fragment" adata-fragment-index="1" -->
- Build output warning <!-- .element: class="fragment" adata-fragment-index="1" -->
- Part of CI build (at least) <!-- .element: class="fragment" adata-fragment-index="1" -->
Note:

- dont forget monorepo slide

- No artifacts without it
- or part of local build
- not part of every build, alwasy commented out

					</script>
				</section>


				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### Bobby problems

- Short deadlines  <!-- .element: class="fragment" -->
- Unrealistic deadlines for complicated upgrades  <!-- .element: class="fragment" -->
- Non advertised deadlines  <!-- .element: class="fragment" -->
- Perfect storm before "code freeze" <!-- .element: class="fragment" -->

Note:

- Dont abuse grace period
- deadlines affect all teams
- announce big upgrades in other channels
- not just bobby warnings

					</script>
				</section>


				<section data-background="#007700" data-transition="zoom-in slide-out">

					<h2>Install Bobby</h2>

<code class="fragment">~/.sbt/0.13/plugins/build.sbt</code>

<pre class="fragment"><code data-trim data-noescape>
resolvers += Resolver.url( "hmrc-sbt-plugin-releases",
	url("https://dl.bintray.com/hmrc/sbt-plugin-releases")
)(Resolver.ivyStylePatterns)

addSbtPlugin("uk.gov.hmrc" % "sbt-bobby" % "<i>0.30.0</i>")
</code></pre>

<code class="fragment">sbt validate</code>

<aside class="notes">
	include validate in automated build commands
</aside>

				</section>


				<section data-background="#007700" data-transition="zoom-in slide-out">

					<h2>Configure Bobby</h2>

<code>~/.sbt/bobby.conf</code>

<pre><code>deprecated-dependencies = https://some-url/bobby-deprecated.json
deprecated-dependencies = file:///~/.sbt/bobby-deprecated.json
</code></pre>

<code class="fragment" data-fragment-index="1">~/.sbt/bobby-deprecated.json</code>

<pre class="fragment" data-fragment-index="1"><code data-trim data-noescape>
{
  "libraries":[
	 {
	  "organisation": "com.example",
	  "name": "mylibrary",
	  "range": "(,6.0.0)",
	  "reason": "Security vulnerability before v6",
	  "from": "2016-06-23"
	 }
  ],
  "plugins":[]
}
</code></pre>

				</section>



				<section data-background="#007700" data-transition="zoom-in slide-out">

					<h2>Blacklist versions</h2>

					<table>
						<thead>
							<tr>
								<th>Range</th>
								<th>Meaning</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>(,1.0.0]</td>
								<td>Has to be newer than 1.0.0</td>
							</tr>
							<tr>
								<td>[1.0.0]</td>
								<td>Can't use v1.0.0</td>
							</tr>
							<tr>
								<td>[1.2.0,1.3.0]</td>
								<td>1.2.0 &lt;= x &lt;= 1.3.0</td>
							</tr>
							<tr>
								<td>[1.0.0,2.0.0)</td>
								<td>1.0.0 &lt;= x &lt; 2.0.0</td>
							</tr>
							<tr>
								<td>[1.5.0,)</td>
								<td>Has to be older than 1.5.0</td>
							</tr>
							<tr>
								<td>[*-SNAPSHOT]</td>
								<td>No SNAPSHOTs</td>
							</tr>
						</tbody>
					</table>

					<aside class="notes">
						- Note difference between [ and (
					</aside>

				</section>



					<section data-background="#007700" data-transition="zoom-in slide-out">

						<h2>Build fail</h2>

						<img class="stretch" src="images/bobby-fail.png"/>

						<aside class="notes">

						</aside>

					</section>
				</section>


				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### Architecture &amp; pipeline

- Simple
- Uncoupled
- - Microservices
- One team owner per service
- Release all day long

Note:

- micro services
- standardised base service framework and libraries
- roll forward API
- continuas delivery
- spinaker etc

					</script>
				</section>


				<section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### Tools &amp; Automation

Easy permissions <!-- .element: class="fragment" -->
- Allow all (forgiveness) <!-- .element: class="fragment"  -->
- Easy self service (permission) <!-- .element: class="fragment" -->

Quick project bootstrap <!-- .element: class="fragment"  -->

Clear delivery pipeline <!-- .element: class="fragment" -->

One button / automate everything <!-- .element: class="fragment"  -->
- Easy / automated / reproducible <!-- .element: class="fragment" -->


Note:

-bootstrap
- - wiki script then automated
- - Creates repo
- - scaffold code,
- - alerts and monitoring
- - CI job
- delivery
- - thoughtworks go
- - Jenkins 2.0
- - Spinaker
- - team city on steroids
- Integrate all tools in chat
- - CI, repos, deploy tools, monitoring in chat
- - slack hipchat

					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

##  One button

- [blog.flurdy/../one-button-aim-nearly-there](http://blog.flurdy.com/2013/08/one-button-aim-nearly-there.html) <!-- .element: class="fragment" data-fragment-index="1" -->
- Environment configuration in Git <!-- .element: class="fragment" data-fragment-index="2" -->
- - Automatic configuration roll out (Puppet) <!-- .element: class="fragment" data-fragment-index="2" -->
- CI abuse (Team City) <!-- .element: class="fragment" data-fragment-index="3" -->
- - Too many tools <!-- .element: class="fragment" data-fragment-index="4" -->
- - Automatic or one button to <!-- .element: class="fragment" data-fragment-index="5" -->
- - - build, test, smoke&nbsp;test, perf&nbsp;test, deploy, promote, tag, rollback, redeploy, restart&nbsp;server, clean&nbsp;db, migrate&nbsp;db    <!-- .element: class="fragment" data-fragment-index="5" -->



Note:

- tools: deployinator, fabric, team city, puppet, scp,
- Configuration in Prod sometimes had to be approved puppet
- ci abuse = anti pattern

					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">


### Version control everything

- Environments <!-- .element: class="fragment" data-fragment-index="1" -->
- - Puppet, Chef, Ansible, Vagrant, Docker <!-- .element: class="fragment" data-fragment-index="1" -->

- Build and deploy tools  <!-- .element: class="fragment" data-fragment-index="2" -->
- - Jenkins DSL <!-- .element: class="fragment" data-fragment-index="2" -->

Scalable &amp; reproducible <!-- .element: class="fragment" data-fragment-index="3" -->

And test it! <!-- .element: class="fragment" data-fragment-index="4" -->

Note:

- minimise 100 fat finger via UI screw things up accidentally
- prefer other CI (team city)
- but jenkins servers are then reproducible in an instant
- duplicate.
- multiple CI instances etc

					</script>
				</section>


				<section data-background="#007700" data-transition="zoom-in slide-out">


					<h2>Jenkins DSL</h2>

					<ul>
						<li><a href="https://github.com/jenkinsci/job-dsl-plugin">github.com/jenkinsci/job-dsl-plugin</a></li>
						<li><a href="https://github.com/hmrc/jenkins-job-builders">github.com/hmrc/jenkins-job-builders</a></li>
						<li><a href="https://github.com/hmrc/jenkins-jobs">github.com/hmrc/jenkins-jobs</a></li>
					</ul>

					<pre class="fragment"><code data-trim>
import javaposse.jobdsl.dsl.DslFactory
import uk.gov.hmrc.jenkinsjobs.domain.builder.SbtMicroserviceJobBuilder

new SbtMicroserviceJobBuilder('myamazeballs-service').
    withScalaStyle().
    withSCoverage().
   build(this as DslFactory)
</code></pre>

					<pre class="fragment"><code data-trim>./gradlew clean test</code></pre>

					<span class="fragment">Seed job to activate</span>

					<aside class="notes">
						- Groovy not scala
						- ready made builders for many purposes
						- normal builds
						- devops jobs
						- wall displays
					</aside>

				</section>

				</section>


				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### Battle scars

* Pull Request flood
* Pull Request graveyard
* Perfect storm of versions
* Too many frameworks
* Ninjas and clones

Note:
- Too few frameworks

					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

### More information

- http://techtraits.com/microservice.html
- http://blog.flurdy.com/2013/08/one-button-aim-nearly-there.html
- https://github.com/jenkinsci/job-dsl-plugin

					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

					</script>
				</section>

				<section data-markdown data-background="#007700" data-transition="zoom-in slide-out">
	    			<script type="text/template">

Note:



slack communication

outsourced
not in control of skill

more pr process

service manager



					</script>
				</section>


			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
				controls: true,
				progress: true,
				slideNumber: false,
				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
		        	{ src: 'plugin/notes/notes.js', async: true },
				]
			});
		</script>
	</body>
</html>
